# 로그인/인증 기능 구현 계획

## 현재 상황 분석

### ✅ 이미 구현된 항목
1. **로그인/회원가입 페이지**
   - `app/sign-in/[[...sign-in]]/page.tsx` - Clerk 로그인 페이지
   - `app/sign-up/[[...sign-up]]/page.tsx` - Clerk 회원가입 페이지
   - 한국어 로컬라이제이션 적용됨

2. **인증 미들웨어**
   - `middleware.ts` - Clerk 미들웨어 설정됨
   - 기본 인증 체크는 작동하지만 라우트 보호는 없음

3. **인증 상태 확인**
   - Sidebar에서 `useUser()` 훅으로 인증 상태 확인
   - 인증이 필요한 메뉴 항목은 비로그인 시 숨김 처리

### ❌ 누락된 항목
1. **비로그인 사용자 UI**
   - 메인 레이아웃에 로그인/회원가입 버튼 없음
   - 비로그인 사용자를 위한 안내 메시지 없음
   - 로그인 유도 UI 없음

2. **라우트 보호**
   - 인증이 필요한 페이지에 대한 보호 없음
   - 비로그인 사용자가 인증 필요 페이지 접근 시 처리 없음

3. **로그인 상태별 UI 분기**
   - Sidebar/Header/BottomNav에 로그인 버튼 없음
   - 비로그인 사용자용 대체 UI 없음

## 구현 계획

### 1. 비로그인 사용자 UI 추가

#### 1.1. Sidebar에 로그인 버튼 추가
- **파일**: `components/layout/Sidebar.tsx`
- **구현 내용**:
  - `SignedOut` 컴포넌트로 비로그인 상태 감지
  - 비로그인 시 하단에 "로그인" 버튼 표시
  - 버튼 클릭 시 `/sign-in`으로 리다이렉트
  - Instagram 스타일 버튼 디자인 적용

#### 1.2. Header에 로그인 버튼 추가
- **파일**: `components/layout/Header.tsx`
- **구현 내용**:
  - Mobile 전용 Header에 로그인 버튼 추가
  - 우측 상단에 배치 (프로필 아이콘 대신)
  - `SignedOut` 컴포넌트 사용

#### 1.3. BottomNav에 로그인 버튼 추가
- **파일**: `components/layout/BottomNav.tsx`
- **구현 내용**:
  - Mobile 전용 BottomNav에 로그인 버튼 추가
  - 비로그인 시 프로필 아이콘 대신 로그인 아이콘 표시
  - 클릭 시 `/sign-in`으로 리다이렉트

### 2. 홈 피드 페이지 비로그인 사용자 처리

#### 2.1. 비로그인 사용자 안내 UI
- **파일**: `app/(main)/page.tsx` 또는 `components/post/PostFeed.tsx`
- **구현 내용**:
  - 비로그인 사용자에게 로그인 유도 메시지 표시
  - "로그인하여 게시물을 확인하세요" 메시지
  - 로그인/회원가입 버튼 제공
  - 선택사항: 게시물은 보이지만 좋아요/댓글 기능은 비활성화

#### 2.2. 게시물 상호작용 제한
- **파일**: `components/post/PostCard.tsx`, `components/post/LikeButton.tsx`
- **구현 내용**:
  - 비로그인 사용자는 좋아요/댓글 작성 불가
  - 클릭 시 로그인 페이지로 리다이렉트 또는 로그인 모달 표시
  - 시각적 피드백 제공 (버튼 비활성화 스타일)

### 3. 라우트 보호 설정

#### 3.1. 인증 필요 라우트 보호
- **파일**: `middleware.ts`
- **구현 내용**:
  - 인증이 필요한 라우트 정의:
    - `/profile/*` - 프로필 페이지
    - `/create` - 게시물 작성 (이미 모달로 처리됨)
  - 비로그인 사용자 접근 시 `/sign-in`으로 리다이렉트
  - `afterSignInUrl` 쿼리 파라미터로 원래 페이지로 복귀

#### 3.2. 선택적 인증 라우트
- **파일**: `middleware.ts`
- **구현 내용**:
  - 홈 피드는 비로그인 사용자도 접근 가능
  - 로그인 시 더 많은 기능 제공

### 4. 로그인 후 리다이렉트 처리

#### 4.1. 로그인 성공 후 원래 페이지로 복귀
- **파일**: `app/sign-in/[[...sign-in]]/page.tsx`
- **구현 내용**:
  - `redirectUrl` prop에 쿼리 파라미터에서 가져온 원래 URL 사용
  - 기본값은 `/` (홈)

#### 4.2. 회원가입 후 리다이렉트
- **파일**: `app/sign-up/[[...sign-up]]/page.tsx`
- **구현 내용**:
  - 회원가입 성공 후 홈으로 리다이렉트
  - 환영 메시지 표시 (선택사항)

### 5. 로그인 상태별 UI 개선

#### 5.1. Sidebar 로그인 상태별 UI
- **파일**: `components/layout/Sidebar.tsx`
- **구현 내용**:
  - 로그인 시: 기존 메뉴 (홈, 검색, 만들기, 프로필)
  - 비로그인 시: 홈, 검색, 로그인 버튼

#### 5.2. Header 로그인 상태별 UI
- **파일**: `components/layout/Header.tsx`
- **구현 내용**:
  - 로그인 시: 로고 + 알림/DM/프로필 아이콘
  - 비로그인 시: 로고 + 로그인 버튼

#### 5.3. BottomNav 로그인 상태별 UI
- **파일**: `components/layout/BottomNav.tsx`
- **구현 내용**:
  - 로그인 시: 홈, 검색, 만들기, 좋아요, 프로필
  - 비로그인 시: 홈, 검색, 로그인 (프로필 아이콘 대신)

### 6. 로그인 유도 컴포넌트

#### 6.1. LoginPrompt 컴포넌트 생성
- **파일**: `components/auth/LoginPrompt.tsx`
- **구현 내용**:
  - 비로그인 사용자에게 표시할 안내 메시지
  - "로그인하여 더 많은 기능을 이용하세요" 메시지
  - 로그인/회원가입 버튼
  - Instagram 스타일 디자인

#### 6.2. LoginPrompt 사용 위치
- 홈 피드 상단 (선택사항)
- 좋아요/댓글 버튼 클릭 시 (비로그인)
- 프로필 페이지 접근 시 (비로그인)

## 구현 순서

### 1단계: 기본 로그인 버튼 추가 (우선순위: 높음)
1. Sidebar에 로그인 버튼 추가
2. Header에 로그인 버튼 추가
3. BottomNav에 로그인 버튼 추가

### 2단계: 라우트 보호 설정 (우선순위: 높음)
1. middleware.ts에 인증 필요 라우트 보호 추가
2. 로그인 후 원래 페이지로 복귀 처리

### 3단계: 비로그인 사용자 UI 개선 (우선순위: 중간)
1. LoginPrompt 컴포넌트 생성
2. 홈 피드에 비로그인 사용자 안내 추가
3. 게시물 상호작용 제한 (좋아요/댓글)

### 4단계: UX 개선 (우선순위: 낮음)
1. 로그인 성공 후 환영 메시지
2. 회원가입 후 온보딩 가이드 (선택사항)

## 기술 스택

- **Clerk 컴포넌트**:
  - `SignedIn` / `SignedOut` - 인증 상태별 UI 분기
  - `SignInButton` / `SignUpButton` - 로그인/회원가입 버튼
  - `UserButton` - 사용자 프로필 버튼

- **Next.js 라우팅**:
  - `useRouter` - 프로그래밍 방식 리다이렉트
  - 쿼리 파라미터로 원래 페이지 URL 전달

- **스타일링**:
  - Instagram 컬러 스키마 유지
  - 기존 디자인 시스템과 일관성 유지

## 참고 사항

1. **기존 코드와의 호환성**:
   - 현재 Sidebar는 이미 `useUser()` 훅을 사용하여 인증 상태 확인
   - `requiresAuth` 속성으로 메뉴 항목 필터링 중
   - 이 로직을 확장하여 로그인 버튼 추가

2. **사용자 경험**:
   - 비로그인 사용자도 게시물을 볼 수 있어야 함 (Instagram과 동일)
   - 로그인을 유도하되 강제하지 않음
   - 로그인 후 원래 페이지로 자연스럽게 복귀

3. **보안**:
   - API 라우트는 이미 인증 검증 구현됨
   - 클라이언트 사이드 UI만 추가하면 됨
   - 미들웨어에서 라우트 보호 추가

